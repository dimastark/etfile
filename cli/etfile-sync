#!/usr/bin/env node
'use strict';

const cote = require('cote');
const async = require('async');
const program = require('commander');

const checks = require('../utils/checks');

program.parse(process.argv);

if (program.args.length === 0) {
    return console.error('No names to sync');
}

checks.exitIfArbitratorNotStarted();

const requester = new cote.Requester(
    { name: 'Sync requester', key: 'arbitration' },
    { log: false }
);

async.each(program.args, (name, cb) => {
    requester.send({ type: 'sync please', name }, res => {
        console.info(`Synchronize: ${name}, result: ${res}`);
        cb();
    });
}, () => process.exit());
